<p>I have to admit that the previous post on Christmas is actually not much fun. Today I received another pResent from Yixuan which is more interesting:</p>

<p><embed width="560" height="320" src="http://animation.r-forge.r-project.org/swf/new-year-animation-in-R.swf" type="application/x-shockwave-flash"></p>

<p>Basically the code deals with letter polygons (i.e. glyphs) and plot them with proper projections from 3D to 2D space:</p>

<div class="highlight"><pre><code class="r"><span class="c1">## original code by Yixuan &lt;yixuan.qiu@cos.name&gt;, with my slight modification</span>
h.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.193</span><span class="p">,</span> <span class="m">0.295</span><span class="p">,</span> <span class="m">0.295</span><span class="p">,</span> <span class="m">0.703</span><span class="p">,</span> <span class="m">0.703</span><span class="p">,</span> <span class="m">0.804</span><span class="p">,</span> <span class="m">0.804</span><span class="p">,</span> <span class="m">0.703</span><span class="p">,</span> <span class="m">0.703</span><span class="p">,</span>
        <span class="m">0.295</span><span class="p">,</span> <span class="m">0.295</span><span class="p">,</span> <span class="m">0.193</span><span class="p">,</span> <span class="m">0.193</span><span class="p">)</span>
h.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.575</span><span class="p">,</span> <span class="m">0.575</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.475</span><span class="p">,</span>
        <span class="m">0.475</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.935</span><span class="p">)</span>
a1.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.433</span><span class="p">,</span> <span class="m">0.546</span><span class="p">,</span> <span class="m">0.865</span><span class="p">,</span> <span class="m">0.746</span><span class="p">,</span> <span class="m">0.656</span><span class="p">,</span> <span class="m">0.328</span><span class="p">,</span> <span class="m">0.242</span><span class="p">,</span> <span class="m">0.136</span><span class="p">)</span>
a1.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.326</span><span class="p">,</span> <span class="m">0.326</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">)</span>
a2.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.488</span><span class="p">,</span> <span class="m">0.629</span><span class="p">,</span> <span class="m">0.355</span><span class="p">)</span>
a2.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.841</span><span class="p">,</span> <span class="m">0.418</span><span class="p">,</span> <span class="m">0.418</span><span class="p">)</span>
y.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.136</span><span class="p">,</span> <span class="m">0.259</span><span class="p">,</span> <span class="m">0.496</span><span class="p">,</span> <span class="m">0.734</span><span class="p">,</span> <span class="m">0.853</span><span class="p">,</span> <span class="m">0.543</span><span class="p">,</span> <span class="m">0.543</span><span class="p">,</span> <span class="m">0.441</span><span class="p">,</span> <span class="m">0.441</span><span class="p">)</span>
y.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.523</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.431</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.427</span><span class="p">)</span>
n.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.189</span><span class="p">,</span> <span class="m">0.295</span><span class="p">,</span> <span class="m">0.707</span><span class="p">,</span> <span class="m">0.707</span><span class="p">,</span> <span class="m">0.804</span><span class="p">,</span> <span class="m">0.804</span><span class="p">,</span> <span class="m">0.701</span><span class="p">,</span> <span class="m">0.287</span><span class="p">,</span> <span class="m">0.287</span><span class="p">,</span> <span class="m">0.189</span><span class="p">)</span>
n.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.248</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.747</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">)</span>
e.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.222</span><span class="p">,</span> <span class="m">0.787</span><span class="p">,</span> <span class="m">0.787</span><span class="p">,</span> <span class="m">0.324</span><span class="p">,</span> <span class="m">0.324</span><span class="p">,</span> <span class="m">0.757</span><span class="p">,</span> <span class="m">0.757</span><span class="p">,</span> <span class="m">0.324</span><span class="p">,</span> <span class="m">0.324</span><span class="p">,</span>
        <span class="m">0.804</span><span class="p">,</span> <span class="m">0.804</span><span class="p">,</span> <span class="m">0.222</span><span class="p">)</span>
e.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.834</span><span class="p">,</span> <span class="m">0.834</span><span class="p">,</span> <span class="m">0.564</span><span class="p">,</span> <span class="m">0.564</span><span class="p">,</span> <span class="m">0.464</span><span class="p">,</span> <span class="m">0.464</span><span class="p">,</span> <span class="m">0.163</span><span class="p">,</span>
        <span class="m">0.163</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">)</span>
w.x <span class="o">=</span> c<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.099</span><span class="p">,</span> <span class="m">0.254</span><span class="p">,</span> <span class="m">0.439</span><span class="p">,</span> <span class="m">0.564</span><span class="p">,</span> <span class="m">0.738</span><span class="p">,</span> <span class="m">0.902</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0.789</span><span class="p">,</span> <span class="m">0.687</span><span class="p">,</span>
        <span class="m">0.5</span><span class="p">,</span> <span class="m">0.31</span><span class="p">,</span> <span class="m">0.205</span><span class="p">)</span>
w.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.187</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.189</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.935</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span>
        <span class="m">0.063</span><span class="p">,</span> <span class="m">0.826</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">)</span>
p.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.218</span><span class="p">,</span> <span class="m">0.56</span><span class="p">,</span> <span class="m">0.56</span><span class="p">,</span> <span class="m">0.56</span><span class="p">,</span> <span class="m">0.56</span><span class="p">,</span> <span class="m">0.32</span><span class="p">,</span> <span class="m">0.32</span><span class="p">,</span> <span class="m">0.218</span><span class="p">,</span> <span class="m">0.32</span><span class="p">,</span> <span class="m">0.32</span><span class="p">)</span>
p.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> <span class="m">0.933</span><span class="p">,</span> <span class="m">0.832</span><span class="p">,</span> <span class="m">0.518</span><span class="p">,</span> <span class="m">0.418</span><span class="p">,</span> <span class="m">0.418</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.518</span><span class="p">,</span> <span class="m">0.834</span><span class="p">)</span>
p.cir.th <span class="o">=</span> seq<span class="p">(</span>pi<span class="o">/</span><span class="m">2</span><span class="p">,</span> <span class="o">-</span>pi<span class="o">/</span><span class="m">2</span><span class="p">,</span> length.out <span class="o">=</span> <span class="m">50</span><span class="p">)</span>
p1.cir.x <span class="o">=</span> <span class="m">0.56</span> <span class="o">+</span> <span class="m">0.2575</span> <span class="o">*</span> cos<span class="p">(</span>p.cir.th<span class="p">)</span>
p1.cir.y <span class="o">=</span> <span class="m">0.6755</span> <span class="o">+</span> <span class="m">0.2575</span> <span class="o">*</span> sin<span class="p">(</span>p.cir.th<span class="p">)</span>
p2.cir.x <span class="o">=</span> <span class="m">0.56</span> <span class="o">+</span> <span class="m">0.157</span> <span class="o">*</span> cos<span class="p">(</span>p.cir.th<span class="p">)</span>
p2.cir.y <span class="o">=</span> <span class="m">0.6755</span> <span class="o">+</span> <span class="m">0.157</span> <span class="o">*</span> sin<span class="p">(</span>p.cir.th<span class="p">)</span>
p1.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.218</span><span class="p">,</span> p1.cir.x<span class="p">,</span> <span class="m">0.32</span><span class="p">,</span> <span class="m">0.32</span><span class="p">,</span> <span class="m">0.218</span><span class="p">)</span>
p1.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.935</span><span class="p">,</span> p1.cir.y<span class="p">,</span> <span class="m">0.418</span><span class="p">,</span> <span class="m">0.063</span><span class="p">,</span> <span class="m">0.063</span><span class="p">)</span>
p2.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.32</span><span class="p">,</span> p2.cir.x<span class="p">,</span> <span class="m">0.32</span><span class="p">)</span>
p2.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.832</span><span class="p">,</span> p2.cir.y<span class="p">,</span> <span class="m">0.518</span><span class="p">)</span>
r1.cir.th <span class="o">=</span> seq<span class="p">(</span>pi<span class="o">/</span><span class="m">2</span><span class="p">,</span> <span class="m">-7</span><span class="o">/</span><span class="m">18</span> <span class="o">*</span> pi<span class="p">,</span> length.out <span class="o">=</span> <span class="m">50</span><span class="p">)</span>
r2.cir.th <span class="o">=</span> seq<span class="p">(</span>pi<span class="o">/</span><span class="m">2</span><span class="p">,</span> <span class="o">-</span>pi<span class="o">/</span><span class="m">2</span><span class="p">,</span> length.out <span class="o">=</span> <span class="m">50</span><span class="p">)</span>
r1.cir.x <span class="o">=</span> <span class="m">0.578</span> <span class="o">+</span> <span class="m">0.243</span> <span class="o">*</span> cos<span class="p">(</span>r1.cir.th<span class="p">)</span>
r1.cir.y <span class="o">=</span> <span class="m">0.6955</span> <span class="o">+</span> <span class="m">0.243</span> <span class="o">*</span> sin<span class="p">(</span>r1.cir.th<span class="p">)</span>
r2.cir.x <span class="o">=</span> <span class="m">0.578</span> <span class="o">+</span> <span class="m">0.145</span> <span class="o">*</span> cos<span class="p">(</span>r2.cir.th<span class="p">)</span>
r2.cir.y <span class="o">=</span> <span class="m">0.6955</span> <span class="o">+</span> <span class="m">0.145</span> <span class="o">*</span> sin<span class="p">(</span>r2.cir.th<span class="p">)</span>
r1.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.191</span><span class="p">,</span> r1.cir.x<span class="p">,</span> <span class="m">0.877</span><span class="p">,</span> <span class="m">0.75</span><span class="p">,</span> <span class="m">0.54</span><span class="p">,</span> <span class="m">0.297</span><span class="p">,</span> <span class="m">0.297</span><span class="p">,</span> <span class="m">0.191</span><span class="p">)</span>
r1.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.937</span><span class="p">,</span> r1.cir.y<span class="p">,</span> <span class="m">0.059</span><span class="p">,</span> <span class="m">0.059</span><span class="p">,</span> <span class="m">0.448</span><span class="p">,</span> <span class="m">0.448</span><span class="p">,</span> <span class="m">0.059</span><span class="p">,</span> <span class="m">0.059</span><span class="p">)</span>
r2.x <span class="o">=</span> c<span class="p">(</span><span class="m">0.297</span><span class="p">,</span> r2.cir.x<span class="p">,</span> <span class="m">0.297</span><span class="p">)</span>
r2.y <span class="o">=</span> c<span class="p">(</span><span class="m">0.841</span><span class="p">,</span> r2.cir.y<span class="p">,</span> <span class="m">0.55</span><span class="p">)</span>
draw.ch <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x1<span class="p">,</span> y1<span class="p">,</span> x2 <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> y2 <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> center.x<span class="p">,</span> color<span class="p">,</span> alpha<span class="p">,</span> xscale<span class="p">)</span> <span class="p">{</span>
  rgb.col <span class="o">=</span> col2rgb<span class="p">(</span>color<span class="p">)</span><span class="o">/</span><span class="m">255</span>
  x1 <span class="o">=</span> x1 <span class="o">*</span> xscale <span class="o">+</span> center.x <span class="o">-</span> <span class="m">0.5</span> <span class="o">*</span> xscale
  x2 <span class="o">=</span> x2 <span class="o">*</span> xscale <span class="o">+</span> center.x <span class="o">-</span> <span class="m">0.5</span> <span class="o">*</span> xscale
  polygon<span class="p">(</span>x1<span class="p">,</span> y1<span class="p">,</span> col <span class="o">=</span> rgb<span class="p">(</span>rgb.col<span class="p">[</span><span class="m">1</span><span class="p">],</span> rgb.col<span class="p">[</span><span class="m">2</span><span class="p">],</span> rgb.col<span class="p">[</span><span class="m">3</span><span class="p">],</span>
                            alpha <span class="o">=</span> alpha<span class="p">),</span> border <span class="o">=</span> <span class="kc">NA</span><span class="p">)</span>
  polygon<span class="p">(</span>x2<span class="p">,</span> y2<span class="p">,</span> col <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span> border <span class="o">=</span> <span class="kc">NA</span><span class="p">)</span>
<span class="p">}</span>
x1 <span class="o">=</span> list<span class="p">(</span>h.x<span class="p">,</span> a1.x<span class="p">,</span> p1.x<span class="p">,</span> p1.x<span class="p">,</span> y.x<span class="p">,</span> n.x<span class="p">,</span> e.x<span class="p">,</span> w.x<span class="p">,</span> y.x<span class="p">,</span> e.x<span class="p">,</span> a1.x<span class="p">,</span> r1.x<span class="p">)</span>
y1 <span class="o">=</span> list<span class="p">(</span>h.y<span class="p">,</span> a1.y<span class="p">,</span> p1.y<span class="p">,</span> p1.y<span class="p">,</span> y.y<span class="p">,</span> n.y<span class="p">,</span> e.y<span class="p">,</span> w.y<span class="p">,</span> y.y<span class="p">,</span> e.y<span class="p">,</span> a1.y<span class="p">,</span> r1.y<span class="p">)</span>
x2 <span class="o">=</span> list<span class="p">(</span><span class="kc">NULL</span><span class="p">,</span> a2.x<span class="p">,</span> p2.x<span class="p">,</span> p2.x<span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span>
          <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> a2.x<span class="p">,</span> r2.x<span class="p">)</span>
y2 <span class="o">=</span> list<span class="p">(</span><span class="kc">NULL</span><span class="p">,</span> a2.y<span class="p">,</span> p2.y<span class="p">,</span> p2.y<span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span>
          <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> <span class="kc">NULL</span><span class="p">,</span> a2.y<span class="p">,</span> r2.y<span class="p">)</span>
th <span class="o">=</span> seq<span class="p">(</span>pi<span class="o">/</span><span class="m">6</span><span class="p">,</span> <span class="m">2</span> <span class="o">*</span> pi<span class="p">,</span> length.out <span class="o">=</span> <span class="m">12</span><span class="p">)</span>
cols <span class="o">=</span> rainbow<span class="p">(</span><span class="m">200</span><span class="p">)</span>
<span class="c1">## if you don&#39;t want to save the animation into SWF,</span>
<span class="c1">## just comment the function saveSWF()</span>
library<span class="p">(</span>animation<span class="p">)</span>
saveSWF<span class="p">({</span>
  <span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="m">238</span><span class="p">)</span> <span class="p">{</span>
    th <span class="o">=</span> th <span class="o">-</span> pi<span class="o">/</span><span class="m">120</span>
    center.x <span class="o">=</span> <span class="m">3</span> <span class="o">+</span> <span class="m">5</span> <span class="o">*</span> cos<span class="p">(</span>th<span class="p">)</span>
    cols <span class="o">=</span> c<span class="p">(</span>cols<span class="p">[</span><span class="m">-1</span><span class="p">],</span> cols<span class="p">[</span><span class="m">1</span><span class="p">])</span>
    alpha <span class="o">=</span> <span class="m">0.1</span> <span class="o">+</span> <span class="p">(</span><span class="m">50</span> <span class="o">*</span> <span class="p">(</span><span class="m">1</span> <span class="o">-</span> sin<span class="p">(</span>th<span class="p">)))</span><span class="o">/</span><span class="m">100</span>
    alpha <span class="o">=</span> ifelse<span class="p">(</span>alpha <span class="o">&gt;</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> alpha<span class="p">)</span>
    xscale <span class="o">=</span> <span class="o">-</span>sin<span class="p">(</span>th<span class="p">)</span> <span class="o">*</span> <span class="m">1.2</span>
    plot<span class="p">(</span><span class="m">1</span><span class="p">,</span> xlim <span class="o">=</span> c<span class="p">(</span><span class="m">-2</span><span class="p">,</span> <span class="m">8</span><span class="p">),</span> ylim <span class="o">=</span> c<span class="p">(</span><span class="m">-2.5</span><span class="p">,</span> <span class="m">3.5</span><span class="p">),</span> type <span class="o">=</span> <span class="s">&quot;n&quot;</span><span class="p">)</span>
    plot.order <span class="o">=</span> <span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">)[</span>order<span class="p">(</span>xscale <span class="o">&gt;</span> <span class="m">0</span><span class="p">)]</span>
    <span class="kr">for</span> <span class="p">(</span>k <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">)</span> <span class="p">{</span>
      i <span class="o">=</span> plot.order<span class="p">[</span>k<span class="p">]</span>
      draw.ch<span class="p">(</span>x1<span class="p">[[</span>i<span class="p">]],</span> y1<span class="p">[[</span>i<span class="p">]],</span> x2<span class="p">[[</span>i<span class="p">]],</span> y2<span class="p">[[</span>i<span class="p">]],</span> center.x<span class="p">[</span>i<span class="p">],</span>
              color <span class="o">=</span> cols<span class="p">[</span>k <span class="o">+</span> <span class="m">60</span> <span class="o">*</span> <span class="p">(</span> i <span class="o">&gt;=</span> <span class="m">6</span> <span class="o">&amp;</span> i <span class="o">&lt;=</span> <span class="m">8</span> <span class="p">)</span> <span class="o">+</span> <span class="m">120</span> <span class="o">*</span>
                <span class="p">(</span>i <span class="o">&gt;</span> <span class="m">8</span><span class="p">)],</span> alpha<span class="p">[</span>i<span class="p">],</span> xscale<span class="p">[</span>i<span class="p">])</span>
    <span class="p">}</span>
    text<span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">-2.5</span><span class="p">,</span> <span class="s">&quot;Yixuan @ 2009-12-31 (http://yixuan.cos.name)&quot;</span><span class="p">,</span>
         adj <span class="o">=</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> col <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> cex <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>

  <span class="p">}</span>
<span class="p">},</span> interval <span class="o">=</span> <span class="m">0.05</span><span class="p">,</span> dev <span class="o">=</span> <span class="s">&quot;pdf&quot;</span><span class="p">,</span>
        para <span class="o">=</span> list<span class="p">(</span>bg <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span> mar <span class="o">=</span> rep<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">)),</span> width <span class="o">=</span> <span class="m">7</span><span class="p">,</span> height <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
<span class="c1">## in the &#39;fun&#39; package (currently on R-Forge),</span>
<span class="c1">## see demo(&#39;HappyNewYear2010Yixuan&#39;)</span>
</code></pre></div>


<p>Thanks, Yixuan!</p>

<p>By the way, there are even more interesting demos in the <code>fun</code> package, just install the package by <code>install.packages('fun')</code> to see <code>demo(package = 'fun')$results[, 'Item']</code>.</p>
