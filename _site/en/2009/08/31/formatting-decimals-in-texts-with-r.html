<p>Yanping Chen raised a question in the <a href="http://cos.name/cn/topic/16247">Chinese COS forum</a> on the output of Eviews: how to (re)format the decimal coefficients in equations as text output? For example, we want to round the numbers in <code>CC = 16.5547557654 + 0.0173022117998*PP + 0.216234040485 * PP(-1) + 0.810182697599 * (WP + WG)</code> to the 3rd decimal places. This can be simply done by regular expressions, as decimals always begin with a period (<code>.</code>). The basic steps are:</p>

<ol>
<li>find out where are the decimals in the character string;</li>
<li>format them;</li>
<li>replace the original decimals with formatted values;</li>
</ol>


<p>Given a character vector, we can format the decimals with the code below:</p>

<div class="highlight"><pre><code class="r"><span class="c1"># x: equations; FUN: formatting function; ...: passed to FUN</span>
coefFormat <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> FUN<span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
  sapply<span class="p">(</span>x<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>s<span class="p">)</span> <span class="p">{</span>
    dig <span class="o">=</span> sapply<span class="p">(</span>gregexpr<span class="p">(</span><span class="s">&quot;\\.[0-9]+&quot;</span><span class="p">,</span> s<span class="p">),</span> <span class="kr">function</span><span class="p">(</span>m<span class="p">)</span> <span class="p">{</span>
      sapply<span class="p">(</span>seq<span class="p">(</span>along <span class="o">=</span> m<span class="p">),</span> <span class="kr">function</span><span class="p">(</span>i<span class="p">)</span> <span class="p">{</span>
        substr<span class="p">(</span>s<span class="p">,</span> m<span class="p">[</span>i<span class="p">],</span> m<span class="p">[</span>i<span class="p">]</span> <span class="o">+</span> attr<span class="p">(</span>m<span class="p">,</span> <span class="s">&quot;match.length&quot;</span><span class="p">)[</span>i<span class="p">]</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>
    <span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="p">{</span>
      <span class="kr">if</span> <span class="p">(</span>is.null<span class="p">(</span>dim<span class="p">(</span>dig<span class="p">)))</span> <span class="kc">NULL</span> <span class="kr">else</span> <span class="m">1</span><span class="o">:</span>dim<span class="p">(</span>dig<span class="p">)[</span><span class="m">1</span><span class="p">]</span>
    <span class="p">})</span> <span class="p">{</span>
      s <span class="o">=</span> sub<span class="p">(</span>dig<span class="p">[</span>j<span class="p">,</span> <span class="m">1</span><span class="p">],</span> substring<span class="p">(</span>FUN<span class="p">(</span>as.numeric<span class="p">(</span>dig<span class="p">[</span>j<span class="p">,</span> <span class="m">1</span><span class="p">]),</span> <span class="kc">...</span><span class="p">),</span>
        <span class="m">2</span><span class="p">),</span> s<span class="p">,</span> fixed <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
    <span class="p">}</span>
    s
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>


<p>I used <code>sapply()</code> for 3 times to avoid explicit loops but consequently the code might be difficult to read. The critical part is the regular expression <code>\\.[0-9]+</code> which means one of more (controlled by <code>+</code> after <code>[0-9]</code>) digits (<code>[0-9]</code> or <code>[:digit:]</code>) after a decimal point <code>.</code>. As <code>.</code> is a <em>metacharacter</em> in regular expressions, we need to use a backslash before it, and again, <code>\</code> is a special character in R, so we need another backslash to denote a backslash. o:-)</p>

<div class="highlight"><pre><code class="r">x <span class="o">=</span> readLines<span class="p">(</span>zz <span class="o">&lt;-</span> textConnection<span class="p">(</span>
<span class="s">&quot;CC = 16.5547557654 + 0.0173022117998 * PP + 0.216234040485 * PP(-1) + 0.810182697599 * (WP + WG)</span>

<span class="s">II = 20.2782089394 + 0.150221823899 * PP + 0.61594357734 * PP(-1) - 0.157787636546 * KK</span>

<span class="s">WP = 1.50029688603 + C(10) * XX + 0.146673821502 * XX(-1) + 0.130395687204 * AA</span>
<span class="s">&quot;</span><span class="p">))</span>
close<span class="p">(</span>zz<span class="p">)</span>

writeLines<span class="p">(</span>coefFormat<span class="p">(</span>x<span class="p">,</span> round<span class="p">,</span> digits <span class="o">=</span> <span class="m">3</span><span class="p">))</span>
<span class="c1">#  CC = 16.555 + 0.017 * PP + 0.216 * PP(-1) + 0.81 * (WP + WG)</span>
<span class="c1">#</span>
<span class="c1">#  II = 20.278 + 0.15 * PP + 0.616 * PP(-1) - 0.158 * KK</span>
<span class="c1">#</span>
<span class="c1">#  WP = 1.5 + C(10) * XX + 0.147 * XX(-1) + 0.13 * AA</span>
<span class="c1">#</span>
writeLines<span class="p">(</span>coefFormat<span class="p">(</span>x<span class="p">,</span> formatC<span class="p">,</span> digits <span class="o">=</span> <span class="m">3</span><span class="p">,</span> format <span class="o">=</span> <span class="s">&quot;f&quot;</span><span class="p">))</span>
<span class="c1">#  CC = 16.555 + 0.017 * PP + 0.216 * PP(-1) + 0.810 * (WP + WG)</span>
<span class="c1">#  </span>
<span class="c1">#  II = 20.278 + 0.150 * PP + 0.616 * PP(-1) - 0.158 * KK</span>
<span class="c1">#  </span>
<span class="c1">#  WP = 1.500 + C(10) * XX + 0.147 * XX(-1) + 0.130 * AA</span>
<span class="c1">#</span>
</code></pre></div>



