<blockquote><p>Update on 2012/03/04: later the idea was turned into a package <a href="http://cran.r-project.org/package=formatR"><strong>formatR</strong></a> and many details have been enhanced there. See the <a href="https://github.com/yihui/formatR/wiki">wiki page</a> for demos.</p></blockquote>

<p>In the past I used to make use of <code>source(my_source_file, echo = TRUE, prompt = "")</code> to "tidy up" my code because it's not convenient for me to type every space between operators, what's more, I have no fixed rules to break a line or make a proper indent. Thus I need a function to automatically "tidy up" my code.</p>

<p>After I read the source code of the function <code>source()</code>, I quickly found that the actual workhorse is <code>parse()</code>, which can turn your code file into neat expressions, and the rest work is just to extract substrings. Here is a proof of concept:</p>

<div class="highlight"><pre><code class="r">tidy.source <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>file <span class="o">=</span> choose.files<span class="p">())</span> <span class="p">{</span>
   exprs <span class="o">=</span> parse<span class="p">(</span>file<span class="p">)</span>
   <span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>length<span class="p">(</span>exprs<span class="p">))</span> <span class="p">{</span>
       dep <span class="o">=</span> paste<span class="p">(</span>deparse<span class="p">(</span>exprs<span class="p">[</span>i<span class="p">]),</span> collapse <span class="o">=</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
       dep <span class="o">=</span> substring<span class="p">(</span>dep<span class="p">,</span> <span class="m">12</span><span class="p">,</span> nchar<span class="p">(</span>dep<span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span>
       cat<span class="p">(</span>dep<span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



