<p>Tables are pretty common in web pages as data sources, and the most direct way to get these data is probably to copy and paste. This is OK if there are only two or three tables, and when we need to grab 5000 tables in 1000 web pages, we may not really wish to fulfill the task by hand. That is one of the reasons for why we need programming -- we want to be as lazy as possible. Who is willing to spend 2 hours copying and pasting? Just let the computers do the tedious job and we can watch movies.</p>

<p>The R package <a href="http://www.omegahat.org/RSXML/"><strong>XML</strong></a> is a handy tool to deal with web pages (both XML or HTML). I'm actually a big fan of its author, Duncan Temple Lang, who did a lot of work on the infrastructure of statistical computing (see the <a href="http://www.omegahat.org">Omegahat</a> project). Next I use <a href="http://www.public.iastate.edu/~hofmann/stat579/homework/week8.html">the Stat579 homework of week 8</a> as an example to show how to read tables from web pages directly using R, i.e. no Excel, no Word, no copy &amp; paste. The task is to grab 3 data tables from the web pages for 3 states, clean the data and do some graphics. Specifically, I'll take <a href="http://www.disastercenter.com/crime/iacrime.htm">the page for Iowa</a> as an example. See the R code below:</p>

<div class="highlight"><pre><code class="r"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span>require<span class="p">(</span>XML<span class="p">))</span> install.packages<span class="p">(</span><span class="s">&#39;XML&#39;</span><span class="p">)</span>
library<span class="p">(</span>XML<span class="p">)</span>
x <span class="o">=</span> readHTMLTable<span class="p">(</span><span class="s">&#39;http://www.disastercenter.com/crime/iacrime.htm&#39;</span><span class="p">)</span>
<span class="c1">## the 3rd element is what we want</span>
x <span class="o">=</span> x<span class="p">[[</span><span class="m">3</span><span class="p">]]</span>
<span class="c1">## names are in the first 2 rows</span>
nms <span class="o">=</span> as.vector<span class="p">(</span>apply<span class="p">(</span>x<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="p">],</span> <span class="m">2</span><span class="p">,</span> paste<span class="p">,</span> collapse <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
<span class="c1">## remove the first 2 rows because they are not data</span>
x <span class="o">=</span> x<span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span> <span class="p">]</span>
<span class="c1">## assign the names to data</span>
names<span class="p">(</span>x<span class="p">)</span> <span class="o">=</span> nms
<span class="c1">## then remove any characters which are not numbers (i.e. 0-9)</span>
x <span class="o">=</span> sapply<span class="p">(</span>x<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>xx<span class="p">)</span> as.numeric<span class="p">(</span>gsub<span class="p">(</span><span class="s">&#39;[^0-9]&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> xx<span class="p">)))</span>
</code></pre></div>


<p>The most important function is <code>readHTMLTable()</code>, which is a convenient wrapper to parse an HTML page and retrieve the table elements. The rest of work is simply to figure out which table we need. Then we have to remove some characters which are not numbers. This is done by a regular expression <code>[^0-9]</code> in which <code>^</code> means matching any characters other than the following ones (in this case, they are digits from 0 to 9). It is easy to extend this script to reading other web pages too -- just change the URL (e.g. using a loop).</p>

<p>To assist understanding the code above, I put some intermediate results below:</p>

<div class="highlight"><pre><code class="r"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span>require<span class="p">(</span>XML<span class="p">))</span> install.packages<span class="p">(</span><span class="s">&#39;XML&#39;</span><span class="p">)</span>
library<span class="p">(</span>XML<span class="p">)</span>
x <span class="o">=</span> readHTMLTable<span class="p">(</span><span class="s">&#39;http://www.disastercenter.com/crime/iacrime.htm&#39;</span><span class="p">)</span>
str<span class="p">(</span>x<span class="p">,</span> max.level <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="c1"># List of 18</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   52 obs. of  12 variables:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  3 variables:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   2 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  2 variables:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   52 obs. of  12 variables:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  2 variables:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   5 obs. of  13 variables:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  2 variables:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">#  $ NULL:&#39;data.frame&#39;:   1 obs. of  1 variable:</span>
<span class="c1">## the 3rd element is what we want</span>
x <span class="o">=</span> x<span class="p">[[</span><span class="m">3</span><span class="p">]]</span>
head<span class="p">(</span>x<span class="p">)</span>
<span class="c1">#     V1         V2     V3      V4       V5     V6       V7      V8         V9      V10      V11     V12</span>
<span class="c1"># 1                                                Forcible         Aggravated          Larceny- Vehicle</span>
<span class="c1"># 2 Year Population  Index Violent Property Murder     Rape Robbery    assault Burglary    Theft   Theft</span>
<span class="c1"># 3 1960  2,757,537 30,991     656   30,335     17      102     301        236    6,375   21,865   2,095</span>
<span class="c1"># 4 1961  2,779,000 30,035     643   29,392     36       81     291        235    6,356   21,096   1,940</span>
<span class="c1"># 5 1962  2,777,000 31,590     559   31,031     31      105     238        185    7,326   21,668   2,037</span>
<span class="c1"># 6 1963  2,780,000 32,784     629   32,155     35      100     253        241    7,516   22,374   2,265</span>
<span class="c1">## names are in the first 2 rows</span>
nms <span class="o">=</span> as.vector<span class="p">(</span>apply<span class="p">(</span>x<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> <span class="p">],</span> <span class="m">2</span><span class="p">,</span> paste<span class="p">,</span> collapse <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
nms
<span class="c1">#  [1] &quot;Year&quot;              &quot;Population&quot;        &quot;Index&quot;             &quot;Violent&quot;           &quot;Property&quot;</span>
<span class="c1">#  [6] &quot;Murder&quot;            &quot;ForcibleRape&quot;      &quot;Robbery&quot;           &quot;Aggravatedassault&quot; &quot;Burglary&quot;</span>
<span class="c1"># [11] &quot;Larceny-Theft&quot;     &quot;VehicleTheft&quot;</span>
<span class="c1">## remove the first 2 rows because they are not data</span>
x <span class="o">=</span> x<span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">),</span> <span class="p">]</span>
head<span class="p">(</span>x<span class="p">)</span>
<span class="c1">#     V1        V2     V3    V4     V5 V6  V7  V8  V9   V10    V11   V12</span>
<span class="c1"># 3 1960 2,757,537 30,991   656 30,335 17 102 301 236 6,375 21,865 2,095</span>
<span class="c1"># 4 1961 2,779,000 30,035   643 29,392 36  81 291 235 6,356 21,096 1,940</span>
<span class="c1"># 5 1962 2,777,000 31,590   559 31,031 31 105 238 185 7,326 21,668 2,037</span>
<span class="c1"># 6 1963 2,780,000 32,784   629 32,155 35 100 253 241 7,516 22,374 2,265</span>
<span class="c1"># 7 1964 2,756,000 37,383 1,007 36,376 35 137 310 525 8,004 25,733 2,639</span>
<span class="c1"># 8 1965 2,760,000 38,574 1,067 37,507 36 123 354 554 8,398 26,220 2,889</span>
<span class="c1">## assign the names to data</span>
names<span class="p">(</span>x<span class="p">)</span> <span class="o">=</span> nms
head<span class="p">(</span>x<span class="p">)</span>
<span class="c1">#   Year Population  Index Violent Property Murder ForcibleRape Robbery Aggravatedassault Burglary</span>
<span class="c1"># 3 1960  2,757,537 30,991     656   30,335     17          102     301               236    6,375</span>
<span class="c1"># 4 1961  2,779,000 30,035     643   29,392     36           81     291               235    6,356</span>
<span class="c1"># 5 1962  2,777,000 31,590     559   31,031     31          105     238               185    7,326</span>
<span class="c1"># 6 1963  2,780,000 32,784     629   32,155     35          100     253               241    7,516</span>
<span class="c1"># 7 1964  2,756,000 37,383   1,007   36,376     35          137     310               525    8,004</span>
<span class="c1"># 8 1965  2,760,000 38,574   1,067   37,507     36          123     354               554    8,398</span>
<span class="c1">#   Larceny-Theft VehicleTheft</span>
<span class="c1"># 3        21,865        2,095</span>
<span class="c1"># 4        21,096        1,940</span>
<span class="c1"># 5        21,668        2,037</span>
<span class="c1"># 6        22,374        2,265</span>
<span class="c1"># 7        25,733        2,639</span>
<span class="c1"># 8        26,220        2,889</span>
<span class="c1">## then remove any characters which are not numbers (i.e. 0-9)</span>
x <span class="o">=</span> sapply<span class="p">(</span>x<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>xx<span class="p">)</span> as.numeric<span class="p">(</span>gsub<span class="p">(</span><span class="s">&#39;[^0-9]&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> xx<span class="p">)))</span>
head<span class="p">(</span>x<span class="p">)</span>
<span class="c1">#      Year Population Index Violent Property Murder ForcibleRape Robbery Aggravatedassault Burglary</span>
<span class="c1"># [1,] 1960    2757537 30991     656    30335     17          102     301               236     6375</span>
<span class="c1"># [2,] 1961    2779000 30035     643    29392     36           81     291               235     6356</span>
<span class="c1"># [3,] 1962    2777000 31590     559    31031     31          105     238               185     7326</span>
<span class="c1"># [4,] 1963    2780000 32784     629    32155     35          100     253               241     7516</span>
<span class="c1"># [5,] 1964    2756000 37383    1007    36376     35          137     310               525     8004</span>
<span class="c1"># [6,] 1965    2760000 38574    1067    37507     36          123     354               554     8398</span>
<span class="c1">#      Larceny-Theft VehicleTheft</span>
<span class="c1"># [1,]         21865         2095</span>
<span class="c1"># [2,]         21096         1940</span>
<span class="c1"># [3,]         21668         2037</span>
<span class="c1"># [4,]         22374         2265</span>
<span class="c1"># [5,]         25733         2639</span>
<span class="c1"># [6,]         26220         2889</span>
str<span class="p">(</span>x<span class="p">)</span>
<span class="c1">#  num [1:50, 1:12] 1960 1961 1962 1963 1964 ...</span>
<span class="c1">#  - attr(*, &quot;dimnames&quot;)=List of 2</span>
<span class="c1">#   ..$ : NULL</span>
<span class="c1">#   ..$ : chr [1:12] &quot;Year&quot; &quot;Population&quot; &quot;Index&quot; &quot;Violent&quot; ...</span>
</code></pre></div>



