<blockquote><p>Warning: this post has been substantially updated to use the <strong>knitr</strong> package instead of Sweave or <strong>pgfSweave</strong>, and the old version is deprecated now! <a href="/en/2011/05/sweave-and-pgfsweave-in-lyx-2-0-x-experimental/">See this post for most information</a>.</p></blockquote>

<h1>0. Summary</h1>

<iframe src="http://player.vimeo.com/video/32948939?title=0&amp;byline=0&amp;portrait=0" width="501" height="413" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>


<p>Take a look at the above video if you don't understand the title. To put it short, you install LyX (>= 2.0.3) and R (>= 2.14.1) with the <a href="http://cran.r-project.org/package=knitr">knitr</a> package as well as a working LaTeX toolkit such as MikTeX or TeXLive or MacTeX, then you are ready to go.</p>

<p>Gregor Gorjanc published an interesting article "Using Sweave with LyX" in <a href="http://cran.r-project.org/doc/Rnews/Rnews_2008-1.pdf">R News in 2008</a>, which (I believe) makes it much easier to use Sweave. I use command-line tools a lot every day, but I am still "GUI-addicted". (I don't want to comment more about Microsoft Word here.) <a href="http://www.lyx.org">LyX</a> looks like a WYSIWYG tool based on LaTeX, and on the first time I saw it I decided that Word was completely useless to me from then on. In the past, I did not like writing LaTeX documents just because I hate wasting my time on typing the raw commands. For example, I hate typing <code>\item</code> in an <code>itemize</code> environment each time I need a new item. There might be some text editors which can automatically do this tedious task, but the more serious problem is I cannot see the whole picture -- in my eyes there are only commands; my imagination is limited -- it is difficult for me to imagine <code>\section{}</code> to be a section title. However, LyX has provided a perfect solution to lazy people like me. We don't have to write LaTeX documents from scratch, and everything is intuitive in LyX. You can clearly <em>see</em> the structure of your document, as well as figures (instead of <code>\includegraphics{}</code>), tables (instead of the gory <code>\begin{table} numbers 1.4 &amp; 2.2 &amp; 3.8</code>), headings (instead of <code>\title{} \section{}</code>) and math formulae (instead of <code>$\frac{\gamma}{\alpha_{ij}}$</code>)... In all, it is a whole lot easier and faster to write LaTeX documents in LyX. This is the main reason for an easier life of Sweave, because a Sweave document is nothing but a mixture of LaTeX and R code.</p>

<h1>1. Introduction</h1>

<p>Although Sweave in LyX is convenient to use, it was not a trivial task for beginners to configure and understand how it works, but things have become much better now since LyX 2.0.</p>

<p>As we can see in the above video, R code can be easily embedded into LyX. If you are familiar with Sweave, you don't even need time to learn anything. For those who do not know Sweave well, a good place to look at is the help page <code>?Sweave</code>. A Sweave document is dynamic in the sense that everything in the document can be changed by the R code (nothing is hard-coded), so we don't need to worry too much about the specific numbers and plots in the output. Instead, we focus on the code which produces these output. In the above video, I used a LaTeX macro <code>\Sexpr{}</code> to output the value of <code>pi</code> and I don't need to write the specific number <code>3.1415926</code> there.</p>

<h1>2. <strong>pgfSweave</strong></h1>

<blockquote><p>Update: I have switched from pgfSweave to the knitr package now, but what was described below is still true.</p></blockquote>

<p>While Sweave is a great invention for reproducible research, there are other packages which can improve R's default Sweave functionality. A brilliant one is the <strong>pgfSweave</strong> package. It was built upon the cacheSweave package to support caching R objects (to avoid unnecessary repeated computations and save time), and it also provided a mechanism to cache graphics! Beside the speed issues, a remarkable feature is the quality of graphics -- it is unbeatable. I'm not exaggerating. This packages uses the <strong>tikzDevice</strong> package to produce pgf/tikz graphics which are essentially LaTeX code, in other words, the R graphics are represented in the LaTeX language so that they are treated (compiled) in the same way as the body of a LaTeX document. This will make the style of graphics completely consistent with the body of a document, e.g. the fonts.</p>

<p>By the way, I also like the <code>nogin</code> option for Sweave.sty to be the default in pgfSweave, because I really don't like the idea of setting the size of graphics by a LaTeX macro <code>\setkeys{Gin}{width=0.8\textwidth}</code>. In pgfSweave, we just set the width and height naturally in the code chunk options like <code>&lt;&lt;width = 5, height =4&gt;&gt;=</code>.</p>

<p>pgfSweave comes with a command line usage like Sweave: <code>R CMD pgfSweave your-file.Rnw</code>. I'm not using this approach in LyX, because this requires system admin privilege to install pgfSweave. Instead, I use this way:</p>

<pre><code>R -q -e "library(pgfSweave);pgfSweave('yourfile.Rnw')"
</code></pre>

<p>R can accept a string in its <code>-e</code> argument, e.g.</p>

<pre><code>yihui@xie:~$ R -q -e "rnorm(5)"
&gt; rnorm(5)
[1] -0.2970093 -0.2171444  1.5645127  0.5422097  0.7359204
</code></pre>

<p>Later I'll explain how to connect LyX and R/pgfSweave in this way.</p>

<h1>3. Configuration</h1>

<blockquote><p>Update: the several steps of configuration become one step since LyX 2.0.</p></blockquote>

<p>To make LyX work with Sweave, we basically only need one step: configure the <code>PATH</code> variable; see <a href="https://github.com/downloads/yihui/lyx/sweave.pdf">the manual</a> for details.</p>

<h1>4. Demo</h1>

<p>See my <a href="https://github.com/yihui/lyx">lyx</a> and <a href="https://github.com/yihui/knitr">knitr</a> repositories to see many examples.</p>

<h1>5. Bad News</h1>

<blockquote><p>Update: all previous bad news has gone.</p></blockquote>
