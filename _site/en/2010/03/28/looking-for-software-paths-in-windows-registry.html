<p>When we want to call external programs in R under Windows, we often need to know the paths of these programs. For instance, we may want to know where ImageMagick is installed, as we need the <code>convert</code> (<code>convert.exe</code>) utility to convert images to other formats, or where OpenBUGS is installed because we need this path to use the function <code>bugs()</code>. Usually this problem does not exist under Linux, because the executables (or their symbolic links) are often put in the directories which are in the environment variable <code>PATH</code> (e.g. <code>/usr/bin</code>, <code>/usr/local/bin</code>).</p>

<p>However, we may be able to find the paths through the registry if the installation will save the path info in the registry hive. The R function is <code>readRegistry()</code>:</p>

<div class="highlight"><pre><code class="r"><span class="c1">## ImageMagick:</span>
<span class="c1">## I used this trick in the function saveMovie (the animation package)</span>
<span class="o">&gt;</span> readRegistry<span class="p">(</span><span class="s">&quot;SOFTWARE\\ImageMagick\\Current&quot;</span><span class="p">)</span>
<span class="o">$</span>BinPath
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;C:\\Program Files\\ImageMagick&quot;</span>
<span class="o">$</span>CoderModulesPath
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;C:\\Program Files\\ImageMagick\\modules\\coders&quot;</span>
<span class="o">$</span>ConfigurePath
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;C:\\Program Files\\ImageMagick\\config&quot;</span>
<span class="o">$</span>FilterModulesPath
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;C:\\Program Files\\ImageMagick\\modules\\filters&quot;</span>
<span class="o">$</span>LibPath
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;C:\\Program Files\\ImageMagick&quot;</span>
<span class="o">$</span>QuantumDepth
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">16</span>
<span class="o">$</span>Version
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;6.3.8&quot;</span>

<span class="c1">## OpenBUGS</span>
<span class="o">&gt;</span> r <span class="o">=</span> names<span class="p">(</span>readRegistry<span class="p">(</span><span class="s">&quot;Software\\Microsoft\\Windows\\ShellNoRoam\\MUICache&quot;</span><span class="p">,</span>
<span class="o">+</span>    <span class="s">&quot;HCU&quot;</span><span class="p">))</span>
<span class="o">&gt;</span> dirname<span class="p">(</span>r<span class="p">[</span>grep<span class="p">(</span><span class="s">&quot;OpenBUGS\\.exe&quot;</span><span class="p">,</span> r<span class="p">)])</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;C:/Program Files/OpenBUGS&quot;</span>
</code></pre></div>


<p>There is no guarantee for this approach to work on any Windows platforms, but I think this is better than explaining what is the <code>PATH</code> variable to some Windows users...</p>

<h2>Examples</h2>

<p>Here I show two examples for ImageMagick and OpenBUGS respectively. Make sure you are using Windows and have already installed ImageMagick and OpenBUGS. The first example shows how to find ImageMagick and call it to convert a sequence of images (generated by R) to a GIF animation:</p>

<div class="highlight"><pre><code class="r"><span class="c1">## find the bin path of ImageMagick</span>
magick.path <span class="o">=</span> readRegistry<span class="p">(</span><span class="s">&quot;SOFTWARE\\ImageMagick\\Current&quot;</span><span class="p">)</span><span class="o">$</span>BinPath

<span class="kr">if</span> <span class="p">(</span>nzchar<span class="p">(</span>magick.path<span class="p">)</span> <span class="o">&amp;&amp;</span> require<span class="p">(</span>animation<span class="p">))</span> <span class="p">{</span>
    convert <span class="o">=</span> shQuote<span class="p">(</span>normalizePath<span class="p">(</span>file.path<span class="p">(</span>magick.path<span class="p">,</span> <span class="s">&quot;convert.exe&quot;</span><span class="p">)))</span>

    <span class="c1">## record the demo &#39;recur.tree&#39; in png images</span>
    png<span class="p">(</span><span class="s">&quot;magickEx%d.png&quot;</span><span class="p">)</span>
    demo<span class="p">(</span>recur.tree<span class="p">)</span>
    dev.off<span class="p">()</span>

    <span class="c1">## call convert.exe to convert png images to GIF</span>
    cmd <span class="o">=</span> paste<span class="p">(</span>sprintf<span class="p">(</span><span class="s">&quot;%s -delay&quot;</span><span class="p">,</span> convert<span class="p">),</span> <span class="m">100</span><span class="p">,</span> <span class="s">&quot;-loop 0 magickEx*.png magickEx.gif&quot;</span><span class="p">)</span>

    <span class="c1">## try to open the GIF animation</span>
    <span class="kr">if</span> <span class="p">(</span>system<span class="p">(</span>cmd<span class="p">)</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span>
        shell.exec<span class="p">(</span>file.path<span class="p">(</span>getwd<span class="p">(),</span> <span class="s">&quot;magickEx.gif&quot;</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<p>You should be able to see the output as this:</p>

<p><img src="http://i.imgur.com/O8BJB.gif" alt="ImageMagick Example" /></p>

<p>OpenBUGS example:</p>

<div class="highlight"><pre><code class="r">r <span class="o">=</span> names<span class="p">(</span>readRegistry<span class="p">(</span><span class="s">&quot;Software\\Microsoft\\Windows\\ShellNoRoam\\MUICache&quot;</span><span class="p">,</span>
    <span class="s">&quot;HCU&quot;</span><span class="p">))</span>
bugsDIR <span class="o">=</span> dirname<span class="p">(</span>r<span class="p">[</span>grep<span class="p">(</span><span class="s">&quot;OpenBUGS\\.exe&quot;</span><span class="p">,</span> r<span class="p">)])</span>
<span class="kr">if</span> <span class="p">(</span>length<span class="p">(</span>bugsDIR <span class="o">==</span> <span class="m">1</span><span class="p">))</span> <span class="p">{</span>
    library<span class="p">(</span>R2WinBUGS<span class="p">)</span>
    library<span class="p">(</span>BRugs<span class="p">)</span>
    <span class="c1">## this example comes from ?bugs in R2WinBUGS</span>
    model.file <span class="o">=</span> system.file<span class="p">(</span>package <span class="o">=</span> <span class="s">&quot;R2WinBUGS&quot;</span><span class="p">,</span> <span class="s">&quot;model&quot;</span><span class="p">,</span>
        <span class="s">&quot;schools.txt&quot;</span><span class="p">)</span>
    data<span class="p">(</span>schools<span class="p">)</span>
    J <span class="o">=</span> nrow<span class="p">(</span>schools<span class="p">)</span>
    y <span class="o">=</span> schools<span class="o">$</span>estimate
    sigma.y <span class="o">=</span> schools<span class="o">$</span>sd
    data <span class="o">=</span> list<span class="p">(</span><span class="s">&quot;J&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;sigma.y&quot;</span><span class="p">)</span>
    inits <span class="o">=</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
        list<span class="p">(</span>theta <span class="o">=</span> rnorm<span class="p">(</span>J<span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span> mu.theta <span class="o">=</span> rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span>
            <span class="m">100</span><span class="p">),</span> sigma.theta <span class="o">=</span> runif<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">100</span><span class="p">))</span>
    <span class="p">}</span>
    parameters <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;theta&quot;</span><span class="p">,</span> <span class="s">&quot;mu.theta&quot;</span><span class="p">,</span> <span class="s">&quot;sigma.theta&quot;</span><span class="p">)</span>
    schools.sim <span class="o">=</span> bugs<span class="p">(</span>data<span class="p">,</span> inits<span class="p">,</span> parameters<span class="p">,</span> model.file<span class="p">,</span>
        n.chains <span class="o">=</span> <span class="m">3</span><span class="p">,</span> n.iter <span class="o">=</span> <span class="m">5000</span><span class="p">,</span> bugs.directory <span class="o">=</span> bugsDIR<span class="p">,</span>
        program <span class="o">=</span> <span class="s">&quot;OpenBUGS&quot;</span><span class="p">)</span>
    print<span class="p">(</span>schools.sim<span class="p">)</span>
    plot<span class="p">(</span>schools.sim<span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>You might now be able to run the above examples in your Windows version, and I'll appreciate feedbacks from Vista and Win7 users. If the above approaches do not work, you may run the command <code>regedit</code> (Start --> Run) and search for ImageMagick/OpenBUGS, then change my code accordingly, because the locations of the registry hive for ImageMagick/OpenBUGS may not be the same for different versions of Windows. My session info is as below:</p>

<div class="highlight"><pre><code class="r"><span class="o">&gt;</span> sessionInfo<span class="p">()</span>
R version <span class="m">2.10.1</span> <span class="p">(</span><span class="m">2009-12-14</span><span class="p">)</span>
i386<span class="o">-</span>pc<span class="o">-</span>mingw32

locale<span class="o">:</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> LC_COLLATE<span class="o">=</span>Chinese_People<span class="s">&#39;s Republic of China.936  LC_CTYPE=Chinese_People&#39;</span>s Republic of China.936
<span class="p">[</span><span class="m">3</span><span class="p">]</span> LC_MONETARY<span class="o">=</span>Chinese_People<span class="s">&#39;s Republic of China.936 LC_NUMERIC=C</span>
<span class="s">[5] LC_TIME=Chinese_People&#39;</span>s Republic of China.936    

attached base packages<span class="o">:</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> stats     graphics  grDevices utils     datasets  methods   base     

other attached packages<span class="o">:</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> BRugs_0.5<span class="m">-3</span>          R2WinBUGS_2.1<span class="m">-16</span>     coda_0.13<span class="m">-5</span>          lattice_0.18<span class="m">-3</span>
<span class="p">[</span><span class="m">5</span><span class="p">]</span> formatR_0.1<span class="m">-1</span>        gWidgetsRGtk2_0.0<span class="m">-64</span> gWidgets_0.0<span class="m">-40</span>      animation_1.1<span class="m">-2</span>
<span class="p">[</span><span class="m">9</span><span class="p">]</span> MASS_7.3<span class="m">-5</span>          

loaded via a namespace <span class="p">(</span>and not attached<span class="p">)</span><span class="o">:</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> grid_2.10.1   RGtk2_2.12.18 tools_2.10.1

<span class="o">&gt;</span> Sys.info<span class="p">()[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
 sysname                      release                      version
 <span class="s">&quot;Windows&quot;</span>                         <span class="s">&quot;XP&quot;</span> <span class="s">&quot;build 2600, Service Pack 3&quot;</span>
</code></pre></div>



