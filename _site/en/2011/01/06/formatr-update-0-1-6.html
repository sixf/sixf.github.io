<p>A new version of the <strong>formatR</strong> package is available <a href="http://cran.r-project.org/package=formatR">on CRAN</a> now (binary packages are still on the way). There are three major updates:</p>

<ol>
<li>the inline comments will also be preserved in most cases (in earlier versions, only single lines of comments are preserved)</li>
<li><code>tidy.source()</code> gained a new argument <code>text</code> to accept a character vector as the source code</li>
<li>multi-byte characters are supported in the <code>formatR()</code> GUI now (sorry, this is not completely true in 0.1-6; it has been fixed in 0.1-7)</li>
</ol>


<p>The first feature is a request from Cameron, which is actually from another requestÂ of another user. I also feel this is a necessary feature even from the first version of this package, but dealing with inline comments is not as easy as the single lines of comments, and it can be dangerous. Please read the help page of the function <code>tidy.source()</code> for all the dark and dirty tricks for preserving R comments when formatting the R code. Here is a quick example:</p>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>formatR<span class="p">)</span>
src <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;# a single line of comments is preserved&quot;</span><span class="p">,</span>
    <span class="s">&quot;1+1&quot;</span><span class="p">,</span> <span class="s">&quot;if(TRUE){&quot;</span><span class="p">,</span>
    paste<span class="p">(</span><span class="s">&quot;x=1  &quot;</span><span class="p">,</span> <span class="s">&quot;# comments begin with at least 2 spaces!&quot;</span><span class="p">),</span>
    <span class="s">&quot;}else{&quot;</span><span class="p">,</span> <span class="s">&quot;x=2;print(&#39;Oh no... ask the right bracket to go away!&#39;)}&quot;</span><span class="p">,</span>
    <span class="s">&quot;1*3 # this comment will be dropped!&quot;</span><span class="p">)</span>
<span class="c1">## source code</span>
cat<span class="p">(</span>src<span class="p">,</span> sep <span class="o">=</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="c1">## # a single line of comments is preserved</span>
<span class="c1">## 1+1</span>
<span class="c1">## if(TRUE){</span>
<span class="c1">## x=1   # comments begin with at least 2 spaces!</span>
<span class="c1">## }else{</span>
<span class="c1">## x=2;print(&#39;Oh no... ask the right bracket to go away!&#39;)}</span>
<span class="c1">## 1*3 # this comment will be dropped!</span>
</code></pre></div>


<p>We can reformat the code as:</p>

<div class="highlight"><pre><code class="r"><span class="c1">## the formatted version</span>
tidy.source<span class="p">(</span>text <span class="o">=</span> src<span class="p">)</span>
<span class="c1">## # a single line of comments is preserved</span>
<span class="c1">## 1 + 1</span>
<span class="c1">## if (TRUE) {</span>
<span class="c1">##     x = 1   # comments begin with at least 2 spaces!</span>
<span class="c1">## } else {</span>
<span class="c1">##     x = 2</span>
<span class="c1">##     print(&quot;Oh no... ask the right bracket to go away!&quot;)</span>
<span class="c1">## }</span>
<span class="c1">## 1 * 3</span>
</code></pre></div>



